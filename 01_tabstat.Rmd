# Deskription {#desc1} 

```{r setup1, echo = F, message=F, warning = F}
.libPaths("D:/R-library4")
knitr::opts_chunk$set(collapse = TRUE)
knitr::opts_chunk$set(dpi=800)
# knitr::opts_chunk$set(collectcode = T)
library(Statamarkdown)
library(tidyverse)
library(kableExtra)
# stataexe <- "C:/Program Files (x86)/Stata13/StataSE-64.exe"
stataexe <- "C:/Program Files/Stata16/StataSE-64.exe"
knitr::opts_chunk$set(engine.path=list(stata=stataexe))
baua <- readstata13::read.dta13("D:/Datenspeicher/BIBB_BAuA/BIBBBAuA_2018_suf1.0.dta",convert.factors = F)
```

## Metrische Variablen beschreiben 

### `tabstat`

Häufig möchten wir aber vielleicht nur eine bestimmte Information. Dafür ist `tabstat` eine gute Lösung. Mit `tabstat` können wir eine ganze Reihe statistischer Kennzahlen für metrische/kontinuierliche Merkmale berechnen. Die Syntax hat dabei das folgende Format: `tabstat zpalter, s(*kennzahl*)`

Hier eine Übersicht der Kennzahlen:
```{r, ft.align = "center",message=F,warning=F, echo = F}
library(kableExtra)
opts <- options(knitr.kable.NA = "")

readxl::read_xlsx("03_tabstat.xlsx",sheet = 1) %>% 
  kable() %>% 
  kable_styling(bootstrap_options = "condensed", full_width = F,font_size = 11) %>% 
  column_spec(1,monospace = TRUE)
```

Hier ein Bespielbefehl für die Berechnung des arith. Mittels, des Medians, der Varianz und des Varianzkoeffizienten mit `tabstat`:
```{stata tabstatF, eval = F}
tabstat zpalter, s(mean median var cv)
```

```{stata tabstatT, echo = F}
set linesize 80
qui use "D:\Datenspeicher\BIBB_BAuA/BIBBBAuA_2018_suf1.0.dta", clear
qui mvdecode zpalter, mv(9999)
tabstat zpalter, s(mean median var cv)
```

Allerdings lassen sich mit `tabstat` nicht beliebige Quantil-Grenzen (nur für 5,10,25,50,75,90,95,99) berechnen, dafür können wir `centile` nutzen:
```{stata centileF, eval = F}
centile age, centile(35)
```

```{stata centileT, echo = F}
set linesize 80
qui use "D:\Datenspeicher\BIBB_BAuA/BIBBBAuA_2018_suf1.0.dta", clear
qui mvdecode zpalter, mv(9999)
centile zpalter, centile(35)
```
Aus den Angaben unter `Centile` erfahren wir, dass 35% der Befragten im Datensatz sind 44 Jahre alt oder jünger sind. Dementsprechend sind 65% der Befragten 44 Jahre oder älter.

### Kennzahlen vergleichen mit `tabstat` {#by_vgl}

Interessant sind diese Kennzahlen auch wieder erst im Vergleich zwischen Gruppen. Hierfür steht uns die `by()`-Option von `tabstat` zur Verfügung. Bspw. können wir die Altersangaben von Männern und Frauen vergleichen, indem wir in `tabstat` die Option `by(S1)` verwenden:

```{stata bytabstF, eval = F}
tabstat zpalter, s(mean median var cv) by(S1)
```
```{stata bytabstT, echo = F}
set linesize 80
qui use "D:\Datenspeicher\BIBB_BAuA/BIBBBAuA_2018_suf1.0.dta", clear
qui mvdecode zpalter, mv(9999)
tabstat zpalter, s(mean median var cv) by(S1)
```

Wir sehen hier also, dass sowohl das arith. Mittel als auch der Median des Befragtenalters bei Frauen höher ist als bei Männern. Außerdem ist die Streuung bei Männern höher als bei Frauen.

Eine andere Option ist es, auf den `if`-Befehl zurückzugreifen - siehe [hier](#if_vgl)

### `summarize`

`summarize` gibt uns einen ersten Überblick zur Verteilung einer metrischen Variable:

```{stata su1F, eval = F}
summarize zpalter
```

```{stata su1T, echo = F}
set linesize 80
qui use "D:\Datenspeicher\BIBB_BAuA/BIBBBAuA_2018_suf1.0.dta", clear
qui mvdecode zpalter, mv(9999)
summarize zpalter
```
Wir erfahren also, dass die Befragten im Mittel 47.19228 Jahre alt sind, die jüngsten Befragten 15 Jahre alt und ältesten Befragten sind 87 Jahre alt.

Mit der Option `,detail` bekommen wir eine deutlich umfangreichere Auskunft:
```{stata su2F, eval = F}
summarize zpalter, detail
```

```{stata su2T, echo = F}
set linesize 80
qui use "D:\Datenspeicher\BIBB_BAuA/BIBBBAuA_2018_suf1.0.dta", clear
qui mvdecode zpalter, mv(9999)
summarize zpalter, detail
```

Hier wird eine ganze Menge auf einmal angezeigt - die Kennzahlen sind dabei in drei Spalten organisiert: 

+ Aus der ersten Spalte erfahren wir die Quantile (`Percentiles`). Ein Quantil einer Verteilung trennt die Daten so in zwei Teile, dass `x`\% der Daten darunter und 100-`x`\% darüber liegen. Hier können wir zB ablesen, dass 25% der Befragten 38 Jahre oder jünger sind. 95% der Befragten sind <= 63 Jahre alt. Dementsprechend sind 5% der Befragten 63 Jahre oder älter. Die 50%-Grenze für das Alter (*der Median*) liegt bei 49 Jahren.[Mehr zu Perzentilen](#perc)

+ die zweite Spalte gibt uns jeweils die 4 kleinsten und größten Werte für das Alter aus: die 4 kleinsten Alterswerte sind jeweils 15,16,16,16 die größten Werte sind 81,82,83 und 87.

+ in der dritten Spalte bekommen wir eine Reihe weiterer Informationen:
  + die Zahl der Beobachtungen (`Obs`) und das arithmetische Mittel (`Mean`) [mehr zum arithm. Mittel](#mean)
  + die Streuung anhand der Standardabweichung (`Std. Dev.`) und Varianz (`Variance`) [mehr dazu](#variance)
  + sowie die Schiefe (`Skewness`) und Wölbung (`Kurtosis`) [mehr dazu](#sk_kur)

## Übungen 1
### Übung 1-1 {#tabstat}  


(@) Laden Sie den BIBB/BAuA Erwerbstätigenbefragung 2018 (`BIBBBAuA_2018_suf1.dta`). Analysieren Sie die Einkommensangaben (`F518_SUF`):
    + Denken Sie daran, die fehlenden Werte für `F518_SUF` mit als Missing zu überschreiben! (bspw. `mvdecode`, sehen Sie mit `labelbook F518` Codebuch nach, welche Werte als fehlende Angaben zu betrachten sind)
(@) Betrachten Sie die Einkommensangaben mit `summarize`
    + Für wie viele Beobachtungen haben Sie eine gültige Angabe (nicht-Missing)?
    + Wo liegt das arith. Mittel für die Einkommensangaben?
    + Wie können Sie sich den Median mit Hilfe von `summarize` ausgeben lassen?
    + Bei welchem Wert liegt die 75%-Perzentilsgrenze?
    + Sind die Einkommensangaben eher rechts- oder linksschief verteilt?

(@) Verwenden Sie jetzt `tabstat`, um folgende Kennzahlen für `F518_SUF` zu berechnen:
    + Das arithm. Mittel, den Median, das 25%- und 75%-Quartil sowie die Varianz und den Variationskoeffizienten - was sagen Ihnen die Werte jeweils?
    + Berechnen Sie nun alle Werte getrennt für Männer und Frauen (Variable `S1`) - welche Werte erhalten Sie jeweils für die Kennzahlen?
    + Vergleichen Sie die Werte! Wie unterscheiden sich die Einkommensangaben zwischen Männern und Frauen?
  
(@) Berechnen Sie den Gini-Koeffizenten für `F518_SUF`! (Denken Sie daran, vor der ersten Verwendung `fastgini` zu installieren - siehe [hier](#gini))


## Anhang
         
### Kennzahlvergleich mit `tabulate` und der Option `summarize()` 

Wir können aber auch zwei Variablen für den Kennzahlenvergleich verwenden. Bspw. sind neben Ost-West-Vergleichen auch häufig Geschlechterunterschiede von Interesse. Stata stellt uns damit mit der `summarise`-Option eine einfache Möglichkeit zur Verfügung:

```{stata tabsuF, eval = F}
tab gkpol S1, summarize(zpalter)
```
```{stata tabsuT, echo = F}
set linesize 80
qui use "D:\Datenspeicher\BIBB_BAuA/BIBBBAuA_2018_suf1.0.dta", clear
qui mvdecode zpalter, mv(9999)
tab gkpol S1, summarize(zpalter)
```
> <span style="color:#FFA500FF"><i>Leider funktioniert die Darstellung hier nicht richtig - in Stata werden die Label richtig angezeigt</i></span>

Wir sehen hier, dass  524 Männer aus Wohnorten unter 2000 Einwohnern befragt wurden, die im Durchschnitt 47.30 Jahre alt sind. Die Standardabweichung des Alters in dieser Gruppe beträgt 11.895558 Jahre. Außerdem wurden 785 Frauen aus Wohnorten mit  50.000 bis 99.000 Einwohnern befragt, die im arith. Mittel 48.32 Jahre alt sind und deren Altersangaben eine Standardabweichung 10.9279 aufweisen.

Je nach Präferenz können wir eine der drei Kennzahlen (Anzahl der Beobachtungen, arith. Mittel und Standardabw.) ausblenden in dem wir die entsprechende Option verwenden:

+ `nofreq`               Häufigkeiten ausblenden
+ `nomeans`              arith. Mittel ausblenden
+ `nostandard`           Standardabw. ausblenden
  
`tab gkpol S1, summarize(age) nofreq` würde uns also nur die arith. Mittel und Standardabweichungen ausgeben.  






